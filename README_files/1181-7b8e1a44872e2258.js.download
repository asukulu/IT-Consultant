"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1181],{56486:function(e,t,n){n.d(t,{B8:function(){return S}});var s=n(27573),o=n(4974),r=n(41839),a=n(64914),i=n(15489),l=n(7653),c=n(59679),u=n(70318),d=n(62071),p=n(11096),h=n(70452),m=n(89987),g=n(26921),f=n(57908),x=n(62124),b=n(3095);let y=e=>{let{isStreaming:t,children:n,...o}=e;return t?n:(0,s.jsx)(v,{...o,children:n})},v=e=>{let{children:t,sendMessage:n,contentType:o="text"}=e,r=void 0!==n,[a,i]=(0,l.useState)([]),[c,u]=(0,l.useState)({top:0,left:0,width:0}),[y,v]=(0,l.useState)(!1),[w,C]=(0,l.useState)(!1),[z,S]=(0,l.useState)(""),[R,j]=(0,l.useState)(""),[E,q]=(0,l.useState)(!1),T=(0,l.useRef)(null),k=(0,l.useRef)(null),M=(0,l.useCallback)(e=>{var t;let n=function(e){let t=[];for(let n=0;n<e.rangeCount;n++){let s=e.getRangeAt(n);if(s.startContainer===s.endContainer&&s.startContainer.nodeType===Node.TEXT_NODE){let e=s.startContainer,n=document.createRange();for(let o=s.startOffset;o<s.endOffset;o++){n.setStart(e,o),n.setEnd(e,o+1);let s=Array.from(n.getClientRects());t.push(...s)}n.detach()}else{let e=function(e){let t;let n=[],s=document.createTreeWalker(e.commonAncestorContainer,NodeFilter.SHOW_TEXT,t=>e.intersectsNode(t)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT);for(;t=s.nextNode();)n.push(t);return n}(s);e.forEach((n,o)=>{let r=document.createRange(),a="length"in n?n.length:0,i=0===o,l=o===e.length-1,c=i?s.startOffset:0,u=l?s.endOffset:a;r.setStart(n,c),r.setEnd(n,u);let d=Array.from(r.getClientRects());t.push(...d),r.detach()})}}return t}(e),s=null===(t=T.current)||void 0===t?void 0:t.getBoundingClientRect();return Array.from(n).map(e=>({top:e.top-((null==s?void 0:s.top)||0)-2.5,left:e.left-((null==s?void 0:s.left)||0),width:e.width,height:e.height+5.5}))},[]),P=(0,l.useCallback)(e=>{var t;let n=e.getRangeAt(0);return null===(t=T.current)||void 0===t?void 0:t.contains(n.commonAncestorContainer)},[]);(0,l.useEffect)(()=>{let e=()=>{q(!0)},t=e=>{"Escape"===e.key&&(C(!1),v(!1),S(""),i([]))},n=e=>{if(k.current&&k.current.contains(e.target))return;let t=window.getSelection();if(t&&!t.isCollapsed&&P(t)){var n,s,o,r;let e,a;let l=M(t);if(i(l),l.every((e,t,n)=>0===t||5>Math.abs(e.top-n[0].top))){let t=Math.max(...l.map(e=>e.left+e.width));e=l[0].top-9,a=t+10}else{let t=Math.max(...l.map(e=>e.top+e.height));a=Math.min(...l.map(e=>e.left)),e=Math.min((null!==(o=null===(s=T.current)||void 0===s?void 0:s.scrollHeight)&&void 0!==o?o:0)-50,t)}let c=((null!==(r=null===(n=T.current)||void 0===n?void 0:n.scrollWidth)&&void 0!==r?r:1e3)-a)/3*2;u({top:e,left:a,width:c}),v(!0),C(!1),j(t.toString())}else i([]),v(!1),C(!1),j(""),S("");q(!1)};return r&&(document.addEventListener("mousedown",e),document.addEventListener("mouseup",n),document.addEventListener("keydown",t)),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("mouseup",n),document.removeEventListener("keydown",t)}},[M,P,r]);let N=e=>{r&&(n(e),S(""),C(!1),v(!1),i([]))},I=()=>"text"===o?R.split("\n").map(e=>"> ".concat(e)).join("\n"):"code"===o?"```\n".concat(R,"\n```"):void 0,F=()=>{N({prompt:"".concat(I(),"\n\n").concat(z),attachments:[],files:[],syncSources:[]})};return(0,s.jsxs)("div",{ref:T,className:(0,f.W)("w-full h-full relative",r?E?"text"===o?"[&_:not(input)::selection]:bg-accent-main-000/20":"[&_:not(input)::selection]:bg-[rgba(240,238,229,0.3)]":"[&_*::selection]:bg-transparent":"","text"===o?"[&_:not(input)::selection]:text-text-200":"[&_:not(input)::selection]:text-[inherit]"),children:[t,a.map((e,t)=>(0,s.jsx)("div",{className:(0,f.W)("absolute pointer-events-none","text"===o?"bg-accent-main-000/20":"bg-[rgba(240,238,229,0.3)]"),style:{top:e.top,left:e.left,width:e.width,height:e.height}},t)),(0,s.jsx)(x.M,{children:y&&!w&&(0,s.jsx)(b.E.div,{className:"absolute z-10",initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},transition:{type:"spring",damping:30,stiffness:400,delay:.2},style:{top:c.top+5,left:c.left},children:(0,s.jsx)("div",{className:(0,f.W)("border-0.5 flex items-center rounded-lg px-2 pb-1 pt-3 shadow transition","text"===o?"bg-bg-000 text-text-400 border-border-300":"bg-[rgba(61,67,79,1)] border-always-white/10"),children:(0,s.jsxs)("div",{className:"-mx-1 -mt-2 flex items-stretch justify-between gap-0.5",children:[(0,s.jsxs)(d.w,{onClick:()=>{C(!0)},isAssistant:!0,className:"text"===o?"":"hover:!bg-[rgba(75,81,93,1)] !text-always-white/90",children:[(0,s.jsx)(h.A,{size:16}),"Improve"]}),(0,s.jsxs)(d.w,{onClick:()=>{N({prompt:"Can you explain this section to me in more detail?\n\n".concat(I()),attachments:[],files:[],syncSources:[]})},isAssistant:!0,className:"text"===o?"":"hover:!bg-[rgba(75,81,93,1)] !text-always-white/90",children:[(0,s.jsx)(m.v,{size:16}),"Explain"]})]})})})}),(0,s.jsx)(x.M,{children:w&&(0,s.jsxs)(b.E.form,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{type:"spring",damping:30,stiffness:400},className:(0,f.W)("z-10 absolute flex gap-2 p-2 pl-4 items-center h-12 rounded-lg","text"===o?"bg-bg-000 text-text-200 border border-0.5 border-border-300 shadow-xl":"bg-always-black/90 text-[rgba(206,204,197,1)] border border-0.5 border-always-white/30 shadow-xl"),style:{top:c.top+5,left:c.left,width:c.width},ref:k,onSubmit:e=>{e.preventDefault(),F()},children:[(0,s.jsx)("input",{type:"text",value:z,onChange:e=>S(e.target.value),placeholder:"Describe what you would like to update...",className:(0,f.W)("py-0.5 px-0 border-0 bg-transparent text-sm grow outline-none focus:outline-none focus:ring-0","text"===o?"text-text-200 placeholder-text-500":"text-always-white/90 placeholder-always-white/50"),autoFocus:!0}),(0,s.jsxs)(x.M,{children:[z.trim().length>0?(0,s.jsx)(b.E.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},transition:{type:"spring",damping:30,stiffness:400,delay:0},children:(0,s.jsx)(p.z,{size:"sm",onClick:()=>F(),"aria-label":"Send Message",type:"submit",className:"shadow-md",children:(0,s.jsxs)("div",{className:"flex items-center gap-2 select-none",children:[(0,s.jsx)("span",{children:"Update"})," ",(0,s.jsx)(g.R,{weight:"bold",size:20,className:"bg-accent-main-000 rounded-[3px] p-1 -mr-1"})]})})}):null," "]})]})})]})},w=e=>{let{title:t,description:n,inset:o,action:r}=e;return(0,s.jsxs)("div",{className:"border-border-300 shadow-sm w-[300px] max-w-full bg-bg-000 rounded-xl p-5 border",children:[(0,s.jsx)("div",{className:"text-left mb-2 font-medium text-sm",children:t}),(0,s.jsx)("p",{className:"mb-2 text-sm",children:n}),!!o&&(0,s.jsx)("div",{className:"flex flex-col rounded-md bg-text-000 bg-opacity-5 p-4 font-mono text-xs text-text-300",children:o}),r&&(0,s.jsx)("div",{className:"flex justify-end",children:(0,s.jsx)(p.z,{variant:"primary",className:"mt-4 text-sm",onClick:r.onClick,disabled:r.disabled,loading:r.loading,children:r.label})})]})},C=e=>{var t,n,o;let{error:r,sendMessage:a,isStreaming:i}=e,[c,u]=(0,l.useState)(!1),d=function(e){switch(e.type){case"UnsupportedImports":return{title:"Artifact failed to load",description:"The generated artifact uses libraries we don't support:",inset:[...e.unsupportedModules,...e.nonExistentIcons.map(e=>"{ ".concat(e,' } from "lucide-react"'))],subtext:"The code itself may still work. To use it, you'll need a development setup with these libraries installed."};case"RuntimeError":return{title:"Error running artifact",description:"An error occurred while trying to run the generated artifact.",inset:[e.message],insetStyle:"danger"};case"FileNotFound":return{title:"File not found",description:'The file "'.concat(e.fileName,'" could not be found.'),subtext:"Please check the file name and try again."};case"ClaudeCompletionError":return{title:"Error in Claude completion",description:e.message}}}(r.error),p="> ".concat(d.description,"\n").concat(null!==(o=null===(t=d.inset)||void 0===t?void 0:t.map(e=>"> `".concat(e,"`")).join("\n"))&&void 0!==o?o:"","\n\n\nCan you fix this error in `").concat(r.artifactId,"`?");return(0,s.jsx)("div",{className:"absolute bottom-5 left-5 right-5",children:(0,s.jsx)(w,{title:d.title,description:d.description,inset:(null===(n=d.inset)||void 0===n?void 0:n.length)?d.inset?(0,s.jsx)("ul",{children:d.inset.map((e,t)=>(0,s.jsx)("li",{children:e},t))}):null:void 0,action:a?{label:"Try fixing with Claude",onClick:()=>{u(!0),null==a||a({prompt:p,attachments:[],files:[],syncSources:[]})},disabled:i,loading:c}:void 0})})};var z=n(42921);let S=e=>{let{content:t,language:n,type:o,showRaw:r,richSandboxRef:c,isCurrentStreaming:u,isChatStreaming:d,onSandboxConfirmation:p,sendMessage:h,richSandboxCapabilities:m,isLatestVersion:g,artifactId:f,artifactVersion:x}=e,b=!r&&void 0!==o&&void 0!==t&&o!==i.JP.Code&&o!==i.JP.Markdown,[y,v]=(0,l.useState)(null),w=(0,l.useCallback)(e=>{void 0!==f&&void 0!==x&&v({error:e,artifactId:f,artifactVersion:x})},[f,x]),S=(0,l.useCallback)(()=>{v(e=>e&&(e.artifactId!==f||e.artifactVersion!==x)?null:e)},[f,x]),E=(0,l.useCallback)(()=>{v(null)},[]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:b?"h-full w-full relative border-none":"absolute opacity-0 w-0 h-0 overflow-hidden pointer-events-none",children:[(0,s.jsx)(z.e,{ref:c,className:b?"h-full w-full border-none bg-always-white":"absolute opacity-0 w-0 h-0 overflow-hidden pointer-events-none",content:b?t:void 0,type:b?o:void 0,onSandboxConfirmation:p,capabilities:m,onReportError:w,onSetContent:S,onRefresh:E}),b&&y&&(0,s.jsx)(C,{error:y,sendMessage:g?h:void 0,isStreaming:d})]}),void 0===t||void 0===o?null:o===i.JP.Code||r?(0,s.jsx)(a.l,{className:"relative flex w-full flex-1 overflow-x-auto overflow-y-scroll",children:(0,s.jsx)(R,{content:t,isStreaming:d,language:n,sendMessage:h},"code-".concat(f,"-").concat(x,"-").concat(u))}):o===i.JP.Markdown?(0,s.jsx)(a.l,{className:"relative flex w-full flex-1 overflow-x-hidden overflow-y-scroll",children:(0,s.jsx)(j,{content:t,isStreaming:d,sendMessage:h},"markdown-".concat(f,"-").concat(x,"-").concat(u))}):null]})},R=e=>{let{content:t,isStreaming:n,language:r,sendMessage:a}=e;return(0,s.jsx)(y,{isStreaming:n,sendMessage:a,contentType:"code",children:(0,s.jsx)(c.Z,{className:"code-block__code !my-0 h-fit min-h-full w-fit min-w-full !rounded-none !text-sm !leading-relaxed",language:r,useInlineStyles:!1,PreTag:"div",style:u.Z,renderer:o.S,children:t})})},j=e=>{let{content:t,isStreaming:n,sendMessage:o}=e;return(0,s.jsx)(y,{isStreaming:n,sendMessage:o,children:(0,s.jsx)("div",{className:"font-claude-message mx-auto w-full max-w-3xl leading-[1.65rem] -tracking-[0.015em] px-6 pb-8 pt-4 md:pt-6 md:px-11",children:(0,s.jsx)(r.ux,{text:t,className:"!gap-3.5"})})})}},42921:function(e,t,n){n.d(t,{e:function(){return g}});var s=n(27573),o=n(51571),r=n(11096),a=n(44846),i=n(13623),l=n(57908),c=n(62124),u=n(3095),d=n(7653),p=n(61867),h=n(3286),m=n(92829);let g=(0,d.forwardRef)((e,t)=>{let{content:n,className:g,type:f,onSandboxConfirmation:x,capabilities:b,onReportError:y,onSetContent:v,onRefresh:w,lazy:C=!0}=e,{userContentRendererUrl:z}=(0,o.m)(),[S,R]=(0,d.useState)(!1),j=(0,d.useRef)(null),{value:E}=(0,a.F)("apps_use_turmeric"),[q,T]=(0,d.useState)(0),k=e=>e>=100,M=(0,d.useCallback)(async e=>e.method===p.to.ReadyForContent?(R(!0),null==x||x(),Promise.resolve()):e.method===p.to.GetFile?b&&b.getFile?Promise.resolve({"@type":"type.googleapis.com/anthropic.claude.usercontent.sandbox.GetFileResponse",value:await b.getFile(e.payload.key)}):Promise.reject():e.method===p.to.SendConversationMessage?b&&b.sendMessage?(await b.sendMessage({prompt:e.payload.message,attachments:[],files:[],syncSources:[]}),Promise.resolve()):Promise.reject():e.method===p.to.ClaudeCompletion?b&&b.claudeComplete?(T(e=>e+1),Promise.resolve({"@type":"type.googleapis.com/anthropic.claude.usercontent.sandbox.ClaudeCompletionResponse",completion:await b.claudeComplete(e.payload.prompt)})):Promise.reject():e.method===p.to.BroadcastContentSize?Promise.resolve():e.method===p.to.ReportError?(null==y||y(e.payload.error),Promise.resolve()):Promise.reject(),[x,b,R,y,T]),P=(0,d.useCallback)(async e=>e===p.to.ClaudeCompletion&&k(q)?"denied":Promise.resolve("accepted"),[q]),{sendRequest:N,updatePermission:I}=(0,m.I)({iframeRef:j,allowedOrigin:z,onCapabilityAction:M,onPermissionRequested:P,initialPermissions:{}});(0,d.useEffect)(()=>{k(q)&&(I(p.to.ClaudeCompletion,"denied"),(0,i.uT)("Claude completion request limit hit."))},[q,I]);let F=(0,d.useCallback)(()=>{(0,i.uT)("Claude completion modal confirmed"),T(0),I(p.to.ClaudeCompletion,"accepted")},[I]),A=(0,d.useCallback)(async e=>{let t=await (null==N?void 0:N(p.to.GetScreenshot,h.D7));if(!(null==t?void 0:t.screenshot))return;if(t.screenshot.length>10485760)throw Error("Screenshot too large");if(!/^data:image\/(png|jpeg|gif);base64,/.test(t.screenshot))throw Error("Invalid screenshot format");let n=e.title.replace(/[^a-zA-Z0-9-_]/g,"_").substring(0,50)+".png";Object.assign(document.createElement("a"),{href:t.screenshot,download:n}).click()},[N]);return(0,d.useEffect)(()=>{S&&n&&f&&(null==v||v(),null==N||N(p.to.SetContent,{content:n,type:f,"@type":"type.googleapis.com/anthropic.claude.usercontent.sandbox.SandboxContent"}))},[n,N,f,S,v]),(0,d.useImperativeHandle)(t,()=>({refresh:()=>{null==w||w(),R(!1);let e=j.current;e&&(e.src="".concat(z).concat(y?"?errorReportingMode=parent":""))},downloadScreenshot:A})),(0,s.jsxs)("div",{className:(0,l.Z)("relative",g),children:[(0,s.jsx)("iframe",{ref:j,className:"h-full w-full",sandbox:"allow-scripts allow-same-origin",title:"Claude content",loading:C?"lazy":void 0,src:"".concat(z).concat(y?"?errorReportingMode=parent":""),allow:"fullscreen"}),(0,s.jsx)(c.M,{children:!S&&(0,s.jsx)(u.E.div,{className:"bg-bg-100 absolute inset-0 z-10",initial:{opacity:1},animate:{opacity:1},exit:{opacity:0},transition:{duration:.15,ease:"easeInOut"}})}),E&&k(q)&&(0,s.jsx)("div",{className:"fixed inset-0 bg-always-black bg-opacity-50 flex items-center justify-center z-modal",children:(0,s.jsxs)("div",{className:"bg-bg-100 p-4 rounded shadow-lg",children:[(0,s.jsx)("p",{className:"text-fg-100 mb-4",children:"Many requests made. Acknowledge that you're still here to continue."}),(0,s.jsx)(r.z,{onClick:F,variant:"primary",children:"I'm still here"})]})})]})});g.displayName="RichSandbox"},61867:function(e,t,n){n.d(t,{KX:function(){return h},O3:function(){return b},P2:function(){return f},TD:function(){return y},q2:function(){return x},to:function(){return o},vr:function(){return m}});var s,o,r=n(15489),a=n(97712),i=n(3286);(s=o||(o={})).ReadyForContent="anthropic.claude.usercontent.sandbox.ReadyForContent",s.SetContent="anthropic.claude.usercontent.sandbox.SetContent",s.GetFile="anthropic.claude.usercontent.sandbox.GetFile",s.SendConversationMessage="anthropic.claude.usercontent.sandbox.SendConversationMessage",s.RunCode="anthropic.claude.usercontent.sandbox.RunCode",s.ClaudeCompletion="anthropic.claude.usercontent.sandbox.ClaudeCompletion",s.ReportError="anthropic.claude.usercontent.sandbox.ReportError",s.GetScreenshot="anthropic.claude.usercontent.sandbox.GetScreenshot",s.BroadcastContentSize="anthropic.claude.usercontent.sandbox.BroadcastContentSize";let l=a.z.object({type:a.z.literal("UnsupportedImports"),unsupportedModules:a.z.array(a.z.string()),nonExistentIcons:a.z.array(a.z.string())}),c=a.z.object({type:a.z.literal("RuntimeError"),message:a.z.string()}),u=a.z.object({type:a.z.literal("FileNotFound"),fileName:a.z.string()}),d=a.z.object({type:a.z.literal("ClaudeCompletionError"),message:a.z.string()}),p=a.z.discriminatedUnion("type",[l,c,u,d]),h=a.z.object({code:a.z.string()}),m=a.z.object({status:a.z.enum(["success","error"]),result:a.z.string().optional(),logs:a.z.array(a.z.string()),error:a.z.string().optional()}),g={"anthropic.claude.usercontent.sandbox.SetContent":{requestSchema:i.Zq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.SetContent"),payload:a.z.strictObject({"@type":a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.SandboxContent"),content:a.z.string(),type:a.z.nativeEnum(r.JP),watchContentSize:a.z.boolean().optional()})}),responseSchema:i.AY,alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.ReadyForContent":{requestSchema:i.Zq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.ReadyForContent"),payload:a.z.strictObject({"@type":a.z.literal("type.googleapis.com/google.protobuf.Empty")})}),responseSchema:i.AY,alwaysPermitted:!0},"anthropic.claude.usercontent.sandbox.BroadcastContentSize":{requestSchema:i.Zq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.BroadcastContentSize"),payload:a.z.strictObject({"@type":a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.BroadcastContentSizePayload"),height:a.z.number(),width:a.z.number()})}),responseSchema:i.AY,alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.GetFile":{requestSchema:i.Zq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.GetFile"),payload:a.z.strictObject({key:a.z.string(),"@type":a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.GetFileRequest")})}),responseSchema:i.Tk.extend({payload:a.z.strictObject({value:a.z.instanceof(Uint8Array).nullable(),"@type":a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.GetFileResponse")})}),alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.SendConversationMessage":{requestSchema:i.Zq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.SendConversationMessage"),payload:a.z.strictObject({message:a.z.string(),messageType:a.z.enum(["text","error"]),"@type":a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.SendConversationMessageRequest")})}),responseSchema:i.AY,alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.RunCode":{requestSchema:i.Zq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.RunCode"),payload:a.z.strictObject({code:a.z.string(),"@type":a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.RunCodeRequest")})}),responseSchema:i.Tk.extend({payload:a.z.strictObject({"@type":a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.RunCodeResponse")}).merge(m)}),alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.ClaudeCompletion":{requestSchema:i.Zq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.ClaudeCompletion"),payload:a.z.strictObject({prompt:a.z.string(),"@type":a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.ClaudeCompletionRequest")})}),responseSchema:i.Tk.extend({payload:a.z.strictObject({completion:a.z.string().nullable(),"@type":a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.ClaudeCompletionResponse")})}),alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.ReportError":{requestSchema:i.Zq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.ReportError"),payload:a.z.strictObject({"@type":a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.ReportErrorRequest"),error:p})}),responseSchema:i.AY,alwaysPermitted:!0},"anthropic.claude.usercontent.sandbox.GetScreenshot":{requestSchema:i.Zq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.GetScreenshot"),payload:a.z.strictObject({"@type":a.z.literal("type.googleapis.com/google.protobuf.Empty")})}),responseSchema:i.Tk.extend({payload:a.z.strictObject({screenshot:a.z.string().nullable(),"@type":a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.GetScreenshotResponse")})}),alwaysPermitted:!1}},f=a.z.enum(["anthropic.claude.usercontent.sandbox.ReadyForContent","anthropic.claude.usercontent.sandbox.GetFile","anthropic.claude.usercontent.sandbox.SendConversationMessage","anthropic.claude.usercontent.sandbox.ClaudeCompletion","anthropic.claude.usercontent.sandbox.ReportError","anthropic.claude.usercontent.sandbox.BroadcastContentSize"]),x=a.z.discriminatedUnion("method",[g["anthropic.claude.usercontent.sandbox.ReadyForContent"].requestSchema,g["anthropic.claude.usercontent.sandbox.GetFile"].requestSchema,g["anthropic.claude.usercontent.sandbox.SendConversationMessage"].requestSchema,g["anthropic.claude.usercontent.sandbox.ClaudeCompletion"].requestSchema,g["anthropic.claude.usercontent.sandbox.ReportError"].requestSchema,g["anthropic.claude.usercontent.sandbox.BroadcastContentSize"].requestSchema]);a.z.union([i.AY,g["anthropic.claude.usercontent.sandbox.GetFile"].responseSchema,g["anthropic.claude.usercontent.sandbox.SendConversationMessage"].responseSchema,g["anthropic.claude.usercontent.sandbox.ClaudeCompletion"].responseSchema]),a.z.enum(["anthropic.claude.usercontent.sandbox.SetContent","anthropic.claude.usercontent.sandbox.RunCode","anthropic.claude.usercontent.sandbox.GetScreenshot"]),a.z.discriminatedUnion("method",[g["anthropic.claude.usercontent.sandbox.SetContent"].requestSchema,g["anthropic.claude.usercontent.sandbox.RunCode"].requestSchema,g["anthropic.claude.usercontent.sandbox.GetScreenshot"].requestSchema]);let b=a.z.union([g["anthropic.claude.usercontent.sandbox.SetContent"].responseSchema,g["anthropic.claude.usercontent.sandbox.RunCode"].responseSchema,g["anthropic.claude.usercontent.sandbox.GetScreenshot"].responseSchema]),y=Object.entries(g).filter(e=>{let[t,n]=e;return!0===n.alwaysPermitted}).map(e=>{let[t,n]=e;return t})},3286:function(e,t,n){n.d(t,{AY:function(){return l},D7:function(){return c},Kj:function(){return i},Tk:function(){return a},Zq:function(){return r},qV:function(){return o},v8:function(){return u}});var s=n(97712);let o=s.z.object({channel:s.z.enum(["request","response"]),requestId:s.z.string()}).passthrough(),r=o.strict().extend({channel:s.z.literal("request"),method:s.z.string(),payload:s.z.strictObject({"@type":s.z.string()})}),a=o.extend({channel:s.z.literal("response"),status:s.z.number().int().min(100).max(599),payload:s.z.strictObject({"@type":s.z.string()}).passthrough()}).passthrough(),i=a.extend({status:s.z.number().int().min(400).max(599),payload:s.z.strictObject({"@type":s.z.literal("type.googleapis.com/anthropic.claude.usercontent.ErrorResponse"),error:s.z.string()})}),l=a.extend({payload:s.z.strictObject({"@type":s.z.literal("type.googleapis.com/google.protobuf.Empty")})}),c={"@type":"type.googleapis.com/google.protobuf.Empty"},u=e=>({"@type":"type.googleapis.com/anthropic.claude.usercontent.ErrorResponse",error:e})},92829:function(e,t,n){n.d(t,{I:function(){return i}});var s=n(7653),o=n(61867),r=n(3286);class a{setupMessageListener(){window.addEventListener("message",this.boundHandleMessage,!1)}handleMessage(e){if(e.origin!==this.allowedOrigin||e.source!==this.iframe.contentWindow)return;let t=Date.now();if(t-this.lastResetTime>this.RESET_INTERVAL&&(this.messageCount=0,this.lastResetTime=t),this.messageCount++,this.messageCount>this.MAX_MESSAGES_PER_INTERVAL){window.removeEventListener("message",this.boundHandleMessage),this.onRateLimited&&this.onRateLimited();return}let n=r.qV.safeParse(e.data);if(!n.success){console.warn("Received message does not conform to basic message shape, ignoring");return}let s=n.data;if("response"===s.channel){this.handleResponse(s);return}this.messageQueue.push(s),this.isConsumerRunning||this.consumeMessages()}handleResponse(e){let t=this.inFlightRequests.get(e.requestId);if(void 0!==t){t(e);return}}async consumeMessages(){for(this.isConsumerRunning=!0;this.messageQueue.length>0;){let e=this.messageQueue.shift();if(!e)continue;let t=o.P2.safeParse(e.method);if(!t.success){this.sendErrorResponse(e.requestId,400,"Unknown method");continue}let n=t.data,s=o.q2.safeParse(e);if(!s.success){this.sendErrorResponse(e.requestId,400,"Invalid payload content");continue}let a=s.data;if(this.requestLog.has(a.requestId)){this.sendErrorResponse(a.requestId,400,"Request ID already processed");continue}this.requestLog.set(a.requestId,{message:a,requestTimestamp:new Date().getTime()}),await this.onPermissionRequested(n).then(e=>"denied"!==e||(this.sendErrorResponse(a.requestId,403,"Permission denied"),!1)).catch(e=>(console.error("Error checking permission for method ".concat(n,":"),e),this.sendErrorResponse(a.requestId,500,"Error checking permission"),!1))&&(this.onCapabilityAction(a,this.boundSendRequest).then(e=>{var t;let n=r.Tk.parse({channel:"response",status:200,requestId:a.requestId,payload:null!=e?e:r.D7}),s=this.requestLog.get(a.requestId);s&&this.requestLog.set(a.requestId,{...s,response:n,responseTimestamp:new Date().getTime()}),null===(t=this.iframe.contentWindow)||void 0===t||t.postMessage(n,this.allowedOrigin)}).catch(e=>{console.error("Error processing action for method ".concat(n,":"),e),this.sendErrorResponse(a.requestId,500,"Internal server error while processing action")}),await new Promise(e=>requestAnimationFrame(e)))}this.isConsumerRunning=!1}sendErrorResponse(e,t,n){var s;let o=r.Kj.parse({channel:"response",status:t,requestId:e,payload:(0,r.v8)(n)}),a=this.requestLog.get(e);a&&this.requestLog.set(e,{...a,response:o,responseTimestamp:new Date().getTime()}),null===(s=this.iframe.contentWindow)||void 0===s||s.postMessage(o,this.allowedOrigin)}restartListening(){window.removeEventListener("message",this.boundHandleMessage),this.messageCount=0,this.lastResetTime=Date.now(),this.setupMessageListener()}cleanup(){window.removeEventListener("message",this.boundHandleMessage),this.messageQueue=[],this.isConsumerRunning=!1,this.inFlightRequests.clear()}async sendRequest(e,t){return new Promise((n,s)=>{var a;let i=Date.now().toString();this.inFlightRequests.set(i,e=>{let t=r.Tk.safeParse(e);if(!t.success){s(Error("Invalid response format"));return}let a=t.data;if(a.status>=400){let e=r.Kj.safeParse(a);e.success?s(Error(e.data.payload.error)):s(Error("Error response (".concat(a.status,")")));return}let i=o.O3.safeParse(a);i.success?n(i.data.payload):s(Error("Invalid response payload for the method"))}),null===(a=this.iframe.contentWindow)||void 0===a||a.postMessage({channel:"request",method:e,requestId:i,payload:t},this.allowedOrigin)})}getRequestLog(){return Array.from(this.requestLog.entries()).map(e=>{let[t,n]=e;return{...n,requestId:t}}).sort((e,t)=>t.requestTimestamp-e.requestTimestamp)}constructor({iframe:e,allowedOrigin:t,onRateLimited:n=null,onPermissionRequested:s,onCapabilityAction:o}){this.messageCount=0,this.lastResetTime=Date.now(),this.MAX_MESSAGES_PER_INTERVAL=30,this.RESET_INTERVAL=5e3,this.onRateLimited=null,this.messageQueue=[],this.isConsumerRunning=!1,this.requestLog=new Map,this.inFlightRequests=new Map,this.iframe=e,this.allowedOrigin=t,this.onRateLimited=n,this.onPermissionRequested=s,this.onCapabilityAction=o,this.boundHandleMessage=this.handleMessage.bind(this),this.boundSendRequest=this.sendRequest.bind(this),this.setupMessageListener()}}function i(e){let{iframeRef:t,allowedOrigin:n,onRateLimited:r=null,initialPermissions:i,onPermissionRequested:l,onCapabilityAction:c}=e,[u,d]=(0,s.useState)(null),p=(0,s.useRef)(i),[h,m]=(0,s.useState)(0);(0,s.useEffect)(()=>{if(!t.current&&h<20){let e=setTimeout(()=>{m(e=>e+1)},500);return()=>clearTimeout(e)}if(!t.current){console.warn("Max retries reached while waiting for iframe");return}let e=new a({iframe:t.current,allowedOrigin:n,onRateLimited:r,onPermissionRequested:async e=>{if(o.TD.includes(e)||"accepted"===p.current[e])return"accepted";let t=await l(e);return p.current={...p.current,[e]:t},t},onCapabilityAction:c});return d(e),()=>{e.cleanup()}},[t,n,p,r,l,c,h]);let g=(0,s.useCallback)(async(e,t)=>{if(u)return u.sendRequest(e,t);throw Error("Communicator not initialized")},[u]),f=(0,s.useCallback)(()=>{null==u||u.restartListening()},[u]),x=(0,s.useCallback)((e,t)=>{p.current={...p.current,[e]:t}},[]);return{sendRequest:null===u?void 0:g,restartListening:f,permissions:p.current,updatePermission:x}}},2190:function(e,t,n){n.d(t,{i:function(){return c},s:function(){return l}});var s=n(89992),o=n(24550),r=n(7653);function a(e,t){let n=new Map;return t.forEach(e=>{var t;let s=null!==(t=n.get(e.file_name))&&void 0!==t?t:[];s.push(e),n.set(e.file_name,s)}),n.get(e)}function i(e,t){let n=a(e,t);if(!n||0===n.length)return null;let s=n.filter(e=>e.file_kind===o.Y.Blob);return 0===s.length?null:s[s.length-1]}function l(){let e=function(){let e=(0,s.OJ)();return(0,r.useCallback)(async(t,n,s,o,r)=>{let a=i(t,n);if(!a&&o){let n=await e("/api/organizations/".concat(s,"/projects/").concat(o,"/docs")),r=(await n.json()).find(e=>e.file_name===t);if(r)return new TextEncoder().encode(r.content);let l=await e("/api/organizations/".concat(s,"/projects/").concat(o,"/files"));a=i(t,await l.json())}if(!a)return null;try{let e=r?"/api/organizations/".concat(s,"/shared_artifact/").concat(r,"/files/").concat(a.file_uuid,"/contents"):"/api/organizations/".concat(s,"/files/").concat(a.file_uuid,"/contents"),t=await fetch(e);if(!t.ok)return null;let n=await t.arrayBuffer();if(n.byteLength>2147483648-1)return null;return new Uint8Array(n)}catch(e){return null}},[e])}();return(0,r.useCallback)(async(t,n,s,o,r,i)=>o?function(e,t){let n=a(e,t);if(!n||0===n.length)return null;let s=n[n.length-1];if(s){let e=s.extracted_content;return new TextEncoder().encode(e)}return null}(t,n)||await e(t,s,o,r,i):null,[e])}function c(e,t,n,s,o){let a=l();return(0,r.useCallback)(async r=>a(r,e,t,n,s,o),[e,t,n,s,a,o])}},97079:function(e,t,n){n.d(t,{C:function(){return s}});let s=async(e,t,n)=>{if(!t||!n)return Promise.resolve(null);try{let t=await fetch("/api/artifacts/api/".concat(n,"/completion"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:e})});if(!t.ok)throw Error("HTTP error! status: ".concat(t.status));let s=await t.json();return Promise.resolve(s.completion)}catch(e){return Promise.reject(e)}}},64914:function(e,t,n){n.d(t,{l:function(){return r}});var s=n(27573),o=n(7653);let r=(0,o.forwardRef)((e,t)=>{let{className:n,children:r,disabled:a}=e,i=(0,o.useRef)(0),l=(0,o.useRef)(!0),c=(0,o.useRef)(null),u=(0,o.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"auto";if(c.current&&l.current){if(c.current.scrollHeight-c.current.clientHeight<c.current.scrollTop)return;if(c.current&&"function"==typeof c.current.scrollTo){var t,n,s;null===(s=c.current)||void 0===s||s.scrollTo({top:(null===(t=c.current)||void 0===t?void 0:t.scrollHeight)-(null===(n=c.current)||void 0===n?void 0:n.clientHeight)+5,behavior:e})}}},[]);return(0,o.useImperativeHandle)(t,()=>({reset(){i.current=0,l.current=!0,u()},scrollToBottomIfPinned:u}),[u]),(0,o.useLayoutEffect)(()=>{!a&&r&&u()},[r,a,u]),(0,s.jsx)("div",{className:n,onScroll:e=>{if(a)return;let t=e.currentTarget.scrollTop,n=function(e,t){if(!e)return!1;{let n=e.scrollHeight-8;return Math.ceil(t+e.offsetHeight)>=Math.floor(n)}}(c.current,t),s=t>i.current;n&&s?l.current=!0:n||s||(l.current=!1),i.current=t},ref:c,children:r})});r.displayName="AutoScroll"}}]);